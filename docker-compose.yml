version: '2'
services:
  # api com we.js
  api:
    build:
      context: ./server/videoteca-api
    user: root
    volumes:
      - "./server/videoteca-api:/usr/src/app"
    ports:
     - "4040:4000"
    links:
     - database
     - session
    environment:
      ENABLE_REQUEST_LOG: 1
      DATABASE_URL: postgres://postgres:3306@database/postgres
      REDIS_HOST: session
      REDIS_PORT: 6379
      REDIS_DB: 40
    command: we run

  # banco de dados
  database:
    image: postgres
    ports:
      - "5433:5432"
    volumes:
      - ./.data/postgresql:/var/lib/postgresql
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: postgres
  # banco de sessao
  session:
    image: redis

  # webapp com ember.js
  webapp:
    image: danlynn/ember-cli:2.7.0
    volumes:
      - ./client/videoteca-webapp:/myapp
      - ./:/parent
    command: server --watcher polling
    ports:
      - "4200:4200"
      - "35729:35729"
